[gd_scene load_steps=63 format=3 uid="uid://dyh7u5c1dupbj"]

[ext_resource type="Resource" uid="uid://dksms452hcjpi" path="res://Inventory/blue_elf_inv.tres" id="1_sxkdj"]
[ext_resource type="Texture2D" uid="uid://c8i5t0fc5yl1v" path="res://Characters/BlueElf/SpriteSheet/down.png" id="2_uje0k"]
[ext_resource type="Texture2D" uid="uid://c7p7vh7c54dsp" path="res://Death/death.png" id="2_wlp37"]
[ext_resource type="Texture2D" uid="uid://o7nmy7gyd2ep" path="res://Characters/BlueElf/SpriteSheet/idle.png" id="3_sgoke"]
[ext_resource type="Texture2D" uid="uid://8js4sbl3u483" path="res://Characters/BlueElf/SpriteSheet/left.png" id="4_syv2x"]
[ext_resource type="Texture2D" uid="uid://c0l3xtue1per4" path="res://Characters/BlueElf/SpriteSheet/right.png" id="5_7u7vy"]
[ext_resource type="Texture2D" uid="uid://di1jbbhl7tbfu" path="res://Characters/BlueElf/SpriteSheet/up.png" id="6_bfp7l"]
[ext_resource type="Texture2D" uid="uid://x57678u75cgh" path="res://Light/light.png" id="8_0hys2"]
[ext_resource type="Script" path="res://Characters/BlueElf/blue_elf_point_light_2d.gd" id="8_lmvnl"]
[ext_resource type="PackedScene" uid="uid://bds25y4t3rdns" path="res://Inventory/inventory_ui.tscn" id="9_knv4y"]

[sub_resource type="GDScript" id="GDScript_d2yxy"]
script/source = "extends CharacterBody2D


@onready var animated_sprite_2d: AnimatedSprite2D = $AnimatedSprite2D
@onready var character_camera: Camera2D = $Camera2D
@onready var inventory_ui: Control = $InventoryUI

@onready var torch = preload(\"res://Inventory/items/torch.tres\")

@export var speed : int = 500
@export var max_horizontal_speed : int = 300
@export var slow_down_speed : int = 1700

enum State {Idle, Walk, Dead}
var current_state : State
var is_selected = false
var frozen = false
var is_alive

@export var inventory : Inv

# Called when the node enters the scene tree for the first time.
func _ready() -> void:
	# Create new inventory for this character
	inventory = Inv.new()
	inventory.slots = []
	for i in range(9):
		var slot = InvSlot.new()
		slot.item = null
		slot.amount = 0
		inventory.slots.append(slot)
		
	inventory.insert(torch)
	
	# Setup inventory UI
	if inventory_ui:
		inventory_ui.set_character_inventory(inventory)
		inventory_ui.close()  # Start with inventory closed
	is_alive = true
	current_state = State.Idle
	set_process_input(true)
	add_to_group(\"characters\")
	add_to_group(\"blue_elf\")
	
func _process(delta: float) -> void:
	# Only process inventory input if this character is selected
	if is_selected and Input.is_action_just_pressed(\"open_inventory\"):
		if inventory_ui:
			if inventory_ui.is_open:
				inventory_ui.close()
			else:
				inventory_ui.open()


func _physics_process(delta: float) -> void:
	if current_state == State.Dead:
		return
	if is_selected:
		player_idle(delta)
		player_run(delta)
		input_movement()
		move_and_slide()
		player_animations()
		
func player_idle(delta: float):
	if !is_alive:
		return
	if is_on_floor():
		current_state = State.Idle

func player_run(delta: float):
	if frozen or !is_alive:
		return
	velocity = Vector2()
	var direction = input_movement()
	velocity.x = direction.x * speed
	velocity.y = direction.y * speed
	if direction.length() > 0:
		current_state = State.Walk
	else:
		current_state = State.Idle

func player_animations():
	if current_state == State.Dead:
		animated_sprite_2d.play(\"death\")
		return
	
	var direction = input_movement()
	if current_state == State.Idle:
		animated_sprite_2d.play(\"idle\")
	elif current_state == State.Walk and direction.x > 0:
		animated_sprite_2d.play(\"right\")
	elif current_state == State.Walk and direction.x < 0:
		animated_sprite_2d.play(\"left\")
	elif current_state == State.Walk and direction.y > 0:
		animated_sprite_2d.play(\"down\")
	elif current_state == State.Walk and direction.y < 0:
		animated_sprite_2d.play(\"up\")

func input_movement() -> Vector2:
	var direction = Vector2()
	direction.x = Input.get_axis(\"move_left\", \"move_right\")
	direction.y = Input.get_axis(\"move_up\", \"move_down\")
	return direction.normalized()

func freeze_character():
	frozen = true
	velocity = Vector2.ZERO

func unfreeze_character():
	frozen = false

func die():
	velocity = Vector2.ZERO
	current_state = State.Dead
	animated_sprite_2d.scale = Vector2(4, 4)
	animated_sprite_2d.play(\"death\")
	await get_tree().create_timer(2).timeout
	queue_free()
	
func activate_camera():
	if character_camera != null:
		is_selected = true
		character_camera.make_current()
	else:
		print(\"Error: Cannot activate camera because character_camera is null.\")

func deactivate_camera():
	is_selected = false

signal change_color


func _on_colored_gate_colored_gate_found() -> void:
	emit_signal(\"change_color\")
	
func collect(item):
	inventory.insert(item)
"

[sub_resource type="CapsuleShape2D" id="CapsuleShape2D_084hp"]
radius = 16.0
height = 60.0

[sub_resource type="AtlasTexture" id="AtlasTexture_jan8l"]
atlas = ExtResource("2_wlp37")
region = Rect2(0, 0, 32, 32)

[sub_resource type="AtlasTexture" id="AtlasTexture_aba6n"]
atlas = ExtResource("2_wlp37")
region = Rect2(32, 0, 32, 32)

[sub_resource type="AtlasTexture" id="AtlasTexture_4cy74"]
atlas = ExtResource("2_wlp37")
region = Rect2(64, 0, 32, 32)

[sub_resource type="AtlasTexture" id="AtlasTexture_4brux"]
atlas = ExtResource("2_wlp37")
region = Rect2(96, 0, 32, 32)

[sub_resource type="AtlasTexture" id="AtlasTexture_kjgsx"]
atlas = ExtResource("2_wlp37")
region = Rect2(128, 0, 32, 32)

[sub_resource type="AtlasTexture" id="AtlasTexture_bkidr"]
atlas = ExtResource("2_wlp37")
region = Rect2(160, 0, 32, 32)

[sub_resource type="AtlasTexture" id="AtlasTexture_io6u3"]
atlas = ExtResource("2_wlp37")
region = Rect2(192, 0, 32, 32)

[sub_resource type="AtlasTexture" id="AtlasTexture_hfoce"]
atlas = ExtResource("2_wlp37")
region = Rect2(224, 0, 32, 32)

[sub_resource type="AtlasTexture" id="AtlasTexture_kmxpd"]
atlas = ExtResource("2_uje0k")
region = Rect2(0, 0, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_uqrfi"]
atlas = ExtResource("2_uje0k")
region = Rect2(64, 0, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_tqkuw"]
atlas = ExtResource("2_uje0k")
region = Rect2(128, 0, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_foaav"]
atlas = ExtResource("2_uje0k")
region = Rect2(192, 0, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_omrue"]
atlas = ExtResource("2_uje0k")
region = Rect2(256, 0, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_mp2v7"]
atlas = ExtResource("2_uje0k")
region = Rect2(320, 0, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_wplog"]
atlas = ExtResource("2_uje0k")
region = Rect2(384, 0, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_msvkv"]
atlas = ExtResource("2_uje0k")
region = Rect2(448, 0, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_oe7ke"]
atlas = ExtResource("2_uje0k")
region = Rect2(512, 0, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_5lmvh"]
atlas = ExtResource("3_sgoke")
region = Rect2(0, 0, 63, 58)

[sub_resource type="AtlasTexture" id="AtlasTexture_46mmi"]
atlas = ExtResource("3_sgoke")
region = Rect2(63, 0, 63, 58)

[sub_resource type="AtlasTexture" id="AtlasTexture_xm4jf"]
atlas = ExtResource("3_sgoke")
region = Rect2(126, 0, 63, 58)

[sub_resource type="AtlasTexture" id="AtlasTexture_qj0vr"]
atlas = ExtResource("4_syv2x")
region = Rect2(0, 0, 64, 62)

[sub_resource type="AtlasTexture" id="AtlasTexture_4lhrj"]
atlas = ExtResource("4_syv2x")
region = Rect2(64, 0, 64, 62)

[sub_resource type="AtlasTexture" id="AtlasTexture_xyskf"]
atlas = ExtResource("4_syv2x")
region = Rect2(128, 0, 64, 62)

[sub_resource type="AtlasTexture" id="AtlasTexture_61d2f"]
atlas = ExtResource("4_syv2x")
region = Rect2(192, 0, 64, 62)

[sub_resource type="AtlasTexture" id="AtlasTexture_lhhkk"]
atlas = ExtResource("4_syv2x")
region = Rect2(256, 0, 64, 62)

[sub_resource type="AtlasTexture" id="AtlasTexture_xrish"]
atlas = ExtResource("4_syv2x")
region = Rect2(320, 0, 64, 62)

[sub_resource type="AtlasTexture" id="AtlasTexture_7p0ju"]
atlas = ExtResource("4_syv2x")
region = Rect2(384, 0, 64, 62)

[sub_resource type="AtlasTexture" id="AtlasTexture_ig6u1"]
atlas = ExtResource("4_syv2x")
region = Rect2(448, 0, 64, 62)

[sub_resource type="AtlasTexture" id="AtlasTexture_dk6gi"]
atlas = ExtResource("4_syv2x")
region = Rect2(512, 0, 64, 62)

[sub_resource type="AtlasTexture" id="AtlasTexture_xrt5f"]
atlas = ExtResource("5_7u7vy")
region = Rect2(0, 0, 64, 62)

[sub_resource type="AtlasTexture" id="AtlasTexture_a16y7"]
atlas = ExtResource("5_7u7vy")
region = Rect2(64, 0, 64, 62)

[sub_resource type="AtlasTexture" id="AtlasTexture_mej3p"]
atlas = ExtResource("5_7u7vy")
region = Rect2(128, 0, 64, 62)

[sub_resource type="AtlasTexture" id="AtlasTexture_04l7n"]
atlas = ExtResource("5_7u7vy")
region = Rect2(192, 0, 64, 62)

[sub_resource type="AtlasTexture" id="AtlasTexture_rs5tt"]
atlas = ExtResource("5_7u7vy")
region = Rect2(256, 0, 64, 62)

[sub_resource type="AtlasTexture" id="AtlasTexture_jj1h0"]
atlas = ExtResource("5_7u7vy")
region = Rect2(320, 0, 64, 62)

[sub_resource type="AtlasTexture" id="AtlasTexture_ilvsb"]
atlas = ExtResource("5_7u7vy")
region = Rect2(384, 0, 64, 62)

[sub_resource type="AtlasTexture" id="AtlasTexture_yhms5"]
atlas = ExtResource("5_7u7vy")
region = Rect2(448, 0, 64, 62)

[sub_resource type="AtlasTexture" id="AtlasTexture_t8yjm"]
atlas = ExtResource("5_7u7vy")
region = Rect2(512, 0, 64, 62)

[sub_resource type="AtlasTexture" id="AtlasTexture_bqdpi"]
atlas = ExtResource("6_bfp7l")
region = Rect2(0, 0, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_w7j7e"]
atlas = ExtResource("6_bfp7l")
region = Rect2(64, 0, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_64341"]
atlas = ExtResource("6_bfp7l")
region = Rect2(128, 0, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_6xqvb"]
atlas = ExtResource("6_bfp7l")
region = Rect2(192, 0, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_uqukg"]
atlas = ExtResource("6_bfp7l")
region = Rect2(256, 0, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_2sqfq"]
atlas = ExtResource("6_bfp7l")
region = Rect2(320, 0, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_0tg7f"]
atlas = ExtResource("6_bfp7l")
region = Rect2(384, 0, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_73k0b"]
atlas = ExtResource("6_bfp7l")
region = Rect2(448, 0, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_o053b"]
atlas = ExtResource("6_bfp7l")
region = Rect2(512, 0, 64, 64)

[sub_resource type="SpriteFrames" id="SpriteFrames_0w5pr"]
animations = [{
"frames": [{
"duration": 1.0,
"texture": SubResource("AtlasTexture_jan8l")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_aba6n")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_4cy74")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_4brux")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_kjgsx")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_bkidr")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_io6u3")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_hfoce")
}],
"loop": false,
"name": &"death",
"speed": 4.0
}, {
"frames": [],
"loop": true,
"name": &"default",
"speed": 5.0
}, {
"frames": [{
"duration": 1.0,
"texture": SubResource("AtlasTexture_kmxpd")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_uqrfi")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_tqkuw")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_foaav")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_omrue")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_mp2v7")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_wplog")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_msvkv")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_oe7ke")
}],
"loop": true,
"name": &"down",
"speed": 7.0
}, {
"frames": [{
"duration": 1.0,
"texture": SubResource("AtlasTexture_5lmvh")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_46mmi")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_xm4jf")
}],
"loop": true,
"name": &"idle",
"speed": 5.0
}, {
"frames": [{
"duration": 1.0,
"texture": SubResource("AtlasTexture_qj0vr")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_4lhrj")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_xyskf")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_61d2f")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_lhhkk")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_xrish")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_7p0ju")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_ig6u1")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_dk6gi")
}],
"loop": true,
"name": &"left",
"speed": 7.0
}, {
"frames": [{
"duration": 1.0,
"texture": SubResource("AtlasTexture_xrt5f")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_a16y7")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_mej3p")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_04l7n")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_rs5tt")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_jj1h0")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_ilvsb")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_yhms5")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_t8yjm")
}],
"loop": true,
"name": &"right",
"speed": 7.0
}, {
"frames": [{
"duration": 1.0,
"texture": SubResource("AtlasTexture_bqdpi")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_w7j7e")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_64341")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_6xqvb")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_uqukg")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_2sqfq")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_0tg7f")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_73k0b")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_o053b")
}],
"loop": true,
"name": &"up",
"speed": 7.0
}]

[sub_resource type="GDScript" id="GDScript_fi2hc"]
script/source = "extends Area2D

func _input_event(viewport, event, shape_idx):
	if event is InputEventMouseButton and event.button_index == MOUSE_BUTTON_LEFT and event.pressed:
		var parent = get_parent()
		if parent is CharacterBody2D:
			MainScene.select_character(parent)
"

[sub_resource type="CapsuleShape2D" id="CapsuleShape2D_n3pre"]
radius = 20.0
height = 60.0

[node name="blue_elf" type="CharacterBody2D"]
collision_layer = 2
collision_mask = 3
script = SubResource("GDScript_d2yxy")
inventory = ExtResource("1_sxkdj")

[node name="CollisionShape2D" type="CollisionShape2D" parent="."]
shape = SubResource("CapsuleShape2D_084hp")

[node name="AnimatedSprite2D" type="AnimatedSprite2D" parent="."]
sprite_frames = SubResource("SpriteFrames_0w5pr")
animation = &"up"
autoplay = "idle"

[node name="Area2D" type="Area2D" parent="."]
collision_layer = 2
collision_mask = 3
script = SubResource("GDScript_fi2hc")

[node name="CollisionShape2D" type="CollisionShape2D" parent="Area2D"]
shape = SubResource("CapsuleShape2D_n3pre")

[node name="PointLight2D" type="PointLight2D" parent="."]
energy = 2.0
texture = ExtResource("8_0hys2")
texture_scale = 0.5
script = ExtResource("8_lmvnl")

[node name="Camera2D" type="Camera2D" parent="."]
limit_left = 500
limit_top = -8000
limit_right = 7500
limit_bottom = 0

[node name="InventoryUI" parent="." instance=ExtResource("9_knv4y")]
offset_left = -117.0
offset_top = -245.0
offset_right = 118.0
offset_bottom = -30.0

[connection signal="change_color" from="." to="PointLight2D" method="_on_blue_elf_change_color"]
